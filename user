<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ­æ´²åšç‰©é¤¨æ”»ç•¥ - æˆ‘çš„æ”¶è—</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="icon" href="../icon/review.png" />
    <style>
      /* ---- å…¨åŸŸæ¨£å¼ ---- */
      html,
      body {
        font-family: "Noto Sans TC", "Inter", sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4ecf3 100%);
        height: 100%;
        margin: 0;
        padding-top: 60px;
        overflow-x: visible !important;
      }
      .main-container {
        overflow-x: hidden;
      }
      /* ---- ä¸Šæ–¹å°è¦½åˆ— ---- */
      .btn-outline-light {
        color: white;
        border-color: white;
      }
      .btn-outline-light:hover {
        background-color: white;
        color: #343a40;
      }
      /* ---- ç”¨æˆ¶å¡ç‰‡ ---- */
      .user-card {
        background: rgba(245, 245, 248, 0.85);
        backdrop-filter: blur(10px);
        border-radius: 1.5rem;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        color: #2e2e3e;
        background-image: linear-gradient(135deg, #c5c3c6 0%, #e3e2e5 100%);
        transition: transform 0.3s ease;
      }
      .user-card:hover {
        transform: translateY(-5px);
      }
      .user-card img {
        border: 3px solid rgba(255, 255, 255, 0.9);
      }
      .user-card .card-text {
        color: #6b6a73 !important;
        font-size: 1rem;
        margin-bottom: 0.5rem;
      }
      .user-card .card-title {
        color: #92d4e6 !important;
        font-size: 1rem;
        font-weight: 700;
      }
      /* ---- æ”¶è—æ¸…å–®å¡ç‰‡ ---- */
      .card {
        border-radius: 1rem;
        border: none;
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.05);
        animation: fadeIn 0.6s ease;
        background: #f6f5f7;
      }
      .card-title {
        font-weight: 700;
        font-size: 1.3rem;
        border-bottom: 2px solid #d8d6d8;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
        color: #4a4a55;
      }
      /* ---- æ”¶è—æ¸…å–®é …ç›® ---- */
      .list-group-item {
        border: none;
        border-radius: 0.75rem;
        margin-bottom: 0.75rem;
        padding: 1rem 1.2rem;
        background: #eceaec;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
        transition: transform 0.2s ease, box-shadow 0.2s ease,
          background-color 0.3s ease;
        flex-direction: column;
        align-items: flex-start !important;
      }
      .list-group-item:hover {
        transform: translateX(6px);
        background: linear-gradient(90deg, #d7d5d8 0%, #fff1f3 100%);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
      }
      .museum-info span {
        font-weight: 600;
        color: #3c3c4b;
      }
      .museum-tips {
        font-size: 0.85rem;
        color: #7a7884;
        margin-top: 4px;
      }
      /* ---- è©•è«–å€ ---- */
      .museum-comment-box {
        width: 100%;
        margin-top: 1rem;
      }
      .museum-comment-box textarea {
        background-color: #f8f8f8;
        border: 1px solid #dcdcdc;
        border-radius: 0.5rem;
        padding: 0.75rem;
        font-size: 0.9rem;
        resize: vertical;
        min-height: 80px;
        transition: border-color 0.3s ease;
      }
      .museum-comment-box textarea:focus {
        border-color: #a0a0a0;
        box-shadow: 0 0 0 0.25rem rgba(108, 117, 125, 0.25);
      }
      /* ---- æ”¶è—é …æŒ‰éˆ• ---- */
      .list-group-item .btn-group {
        display: flex;
        justify-content: flex-end;
        gap: 0.3rem; /* æŒ‰éˆ•é–“è·ç¸®å° */
        margin-top: 0.5rem; /* èˆ‡ä¸Šæ–¹å…§å®¹è·é›¢ç¨å¾®ç¸®å° */
      }
      .list-group-item .btn {
        padding: 0.25rem 0.5rem; /* æ›´å°çš„å…§è· */
        font-size: 0.7rem; /* å­—é«”ç¸®å° */
        line-height: 1.2; /* ä¿æŒå‚ç›´ç½®ä¸­ */
        border-radius: 0.5rem; /* è¼•å¾®åœ“è§’ï¼Œé¿å…å¤ªå¤§ */
      }
      .btn-go {
        background: linear-gradient(135deg, #a8dadc 0%, #b1c3ce 100%);
      }
      .btn-cancel {
        background: linear-gradient(135deg, #ffb6b9 0%, #f28482 100%);
      }
      .list-group-item .btn:hover {
        opacity: 0.9;
        transform: scale(1.05);
      }
      /* ---- å‹•ç•« ---- */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }
      /* ---- å´é‚Šé¸å–® ---- */
      .offcanvas-header {
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding-top: 80px;
      }
      .search-form-offcanvas {
        display: flex;
        padding: 1rem;
        gap: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }
      .offcanvas {
        transition: transform 0.33s ease-in-out !important;
      }
      .offcanvas-start {
        transform: translateX(-100%);
      }
      .offcanvas.show {
        transform: none;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-dark fixed-top top-navbar">
      <div class="container-fluid">
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasMenu"
          aria-controls="offcanvasMenu"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand mx-auto" href="EuropeanMuseum.html"
          >æ­æ´²åšç‰©é¤¨æ”»ç•¥</a
        >
        <div class="d-flex gap-2">
          <a class="btn btn-outline-light" href="userfavorite.html">
            <i class="bi bi-person-circle"></i>ç”¨æˆ¶
          </a>
          <a class="btn btn-outline-light" id="loginBtn" href="log.html"
            >ç™»å…¥</a
          >
        </div>
      </div>
    </nav>
    <div
      class="main-container d-flex flex-column align-items-center gap-4 my-5"
    >
      <div class="card user-card" style="width: 20rem">
        <div
          class="card-body d-flex flex-column align-items-center justify-content-center"
        >
          <img
            src="../img/mr.van.png"
            class="img-fluid rounded-circle mb-3"
            alt="ç”¨æˆ¶é ­åƒ"
            style="width: 100px; height: 100px; object-fit: cover"
          />
          <h5 class="card-text text-center"></h5>
          <p class="card-title text-center" id="favCount">æ”¶è— 0</p>
        </div>
      </div>
      <div class="container my-5">
        <div class="card w-100 w-md-75 w-lg-50 mx-auto">
          <div class="card-body">
            <h1 class="card-title">æˆ‘çš„æ”¶è—</h1>
            <ul class="list-group list-group-flush" id="favList"></ul>
          </div>
        </div>
      </div>
    </div>
    <div
      class="offcanvas offcanvas-start text-bg-dark"
      tabindex="-1"
      id="offcanvasMenu"
      aria-labelledby="offcanvasMenuLabel"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasMenuLabel">æ¢ç´¢å€åŸŸ</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <form class="search-form-offcanvas">
        <input
          class="form-control"
          type="search"
          placeholder="æœå°‹"
          aria-label="Search"
        />
        <button class="btn btn-outline-light" type="submit">
          <i class="bi bi-search"></i>
        </button>
      </form>
      <div class="offcanvas-body">
        <ul class="navbar-nav justify-content-center flex-grow-1 pe-3">
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              >è¥¿æ­</a
            >
            <ul
              class="dropdown-menu dropdown-menu-dark"
              id="WesternEuropeMenu"
            ></ul>
          </li>
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              >å—æ­</a
            >
            <ul
              class="dropdown-menu dropdown-menu-dark"
              id="SouthernEuropeMenu"
            ></ul>
          </li>
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              >æ±æ­</a
            >
            <ul
              class="dropdown-menu dropdown-menu-dark"
              id="EasternEuropeMenu"
            ></ul>
          </li>
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              >åŒ—æ­</a
            >
            <ul
              class="dropdown-menu dropdown-menu-dark"
              id="NorthernEuropeMenu"
            ></ul>
          </li>
        </ul>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // åšç‰©é¤¨é€£çµè³‡æ–™
      const museumLinks = {
        "é˜¿å§†æ–¯ç‰¹ä¸¹åœ‹å®¶åšç‰©é¤¨ Rijksmuseum": "Netherlands.html",
        "æ¢µè°·åšç‰©é¤¨ Van Gogh Museum Amsterdam": "Netherlands.html",
        "è«ç‘æ³°æ–¯çš‡å®¶ç¾è¡“é¤¨ Mauritshuis": "Netherlands.html",
        "åº«å‹’-æ…•å‹’ç¾è¡“é¤¨ KrÃ¶ller-MÃ¼ller Museum": "Netherlands.html",
        "é˜¿å§†æ–¯ç‰¹ä¸¹å¸‚ç«‹åšç‰©é¤¨ Stedelijk Museum Amsterdam": "Netherlands.html",
        "æ—å¸ƒè˜­ä¹‹å®¶åšç‰©é¤¨ Museum Het Rembrandthuis": "Netherlands.html",
        "æµ·ç‰™ç¾ä»£ç¾è¡“é¤¨ Gemeentemuseum Den Haag": "Netherlands.html",
        "ç¾…æµ®å®® MusÃ©e du Louvre": "France.html",
        "å¥§è³½åšç‰©é¤¨ MusÃ©e d'Orsay": "France.html",
        "æ©˜åœ’ç¾è¡“é¤¨ MusÃ©e de l'Orangerie": "France.html",
        "é¾ç•¢åº¦ä¸­å¿ƒ Centre Pompidou": "France.html",
      };

      // åšç‰©é¤¨æç¤ºè³‡è¨Š
      const museumTips = {
        "é˜¿å§†æ–¯ç‰¹ä¸¹åœ‹å®¶åšç‰©é¤¨ Rijksmuseum": "âœ… éœ€ææ—©é ç´„ ï½œ ğŸŸï¸ å¯å€Ÿåšç‰©é¤¨å¡",
        "æ¢µè°·åšç‰©é¤¨ Van Gogh Museum Amsterdam":
          "âœ… éœ€ææ—©ä¸€å€‹æœˆé ç´„ ï½œ ğŸ¤“å­¸ç”Ÿå¯æŠ˜æ‰£",
        "è«ç‘æ³°æ–¯çš‡å®¶ç¾è¡“é¤¨ Mauritshuis": "âœ… éœ€ææ—©é ç´„ ï½œ â° é–‰é¤¨æ™‚é–“è¼ƒæ—©",
        "åº«å‹’-æ…•å‹’ç¾è¡“é¤¨ KrÃ¶ller-MÃ¼ller Museum":
          "ğŸŒ³ ä½æ–¼åœ‹å®¶å…¬åœ’å…§ ï½œ ğŸš² å¯å…è²»é¨å–®è»Š",
        "é˜¿å§†æ–¯ç‰¹ä¸¹å¸‚ç«‹åšç‰©é¤¨ Stedelijk Museum Amsterdam":
          "ğŸ¨ ç¾ä»£è—è¡“æ„›å¥½è€…å¿…è¨ª",
        "æ—å¸ƒè˜­ä¹‹å®¶åšç‰©é¤¨ Museum Het Rembrandthuis": "âœï¸ å¯è§€çœ‹ç‰ˆç•«è£½ä½œç¤ºç¯„",
        "æµ·ç‰™ç¾ä»£ç¾è¡“é¤¨ Gemeentemuseum Den Haag": "ğŸŸ¥ è’™å¾·é‡Œå®‰ä½œå“æœ€å…¨",
        "ç¾…æµ®å®® MusÃ©e du Louvre":
          "âœ… éœ€ææ—©é ç´„ ï½œ ğŸ™…ğŸ¼ å‘¨äºŒå…¬ä¼‘ ï½œ ğŸ•°ï¸ å‘¨ä¸‰/å‘¨äº”å¤œé–“é–‹æ”¾",
        "å¥§è³½åšç‰©é¤¨ MusÃ©e d'Orsay": "âœ… éœ€ææ—©é ç´„ ï½œ ğŸ•°ï¸ å‘¨å››å¤œé–“é–‹æ”¾",
        "æ©˜åœ’ç¾è¡“é¤¨ MusÃ©e de l'Orangerie": "ğŸ–¼ï¸ è«å…§ã€Šç¡è“®ã€‹ä¸»é¡Œ",
        "é¾ç•¢åº¦ä¸­å¿ƒ Centre Pompidou": "ğŸ¨ ç¾ä»£è—è¡“èˆ‡è¨­è¨ˆä¸­å¿ƒ",
      };

      // å–å¾—æ”¶è—è³‡æ–™
      function getFavorites() {
        try {
          const favs = JSON.parse(localStorage.getItem("favorites") || "[]");
          return favs.filter((item) => item && typeof item.name === "string");
        } catch (e) {
          console.error("Failed to parse favorites from localStorage:", e);
          return [];
        }
      }

      // æ¸²æŸ“æ”¶è—æ¸…å–®
      function renderFavs() {
        const favListElement = document.getElementById("favList");
        const favCountElement = document.getElementById("favCount");
        const data = getFavorites();

        if (!favListElement) return;

        favListElement.innerHTML = "";

        if (data.length === 0) {
          favListElement.innerHTML = `<li class='list-group-item text-center'>å°šæœªæ”¶è—ä»»ä½•åšç‰©é¤¨</li>`;
        } else {
          data.forEach((item) => {
            const name = item.name;
            const comment = item.comment || "";
            const tips = museumTips[name] || "";
            const goLink = museumLinks[name] || "#";

            const li = document.createElement("li");
            li.className = "list-group-item";
            li.dataset.name = name;
            li.innerHTML = `
              <div class="d-flex w-100 justify-content-between align-items-center">
                <div class="museum-info">
                  <span>${name}</span>
                  ${
                    tips
                      ? `<small class="museum-tips d-block">${tips}</small>`
                      : ""
                  }
                </div>
                <div class="btn-group">
                  <a href="${goLink}" class="btn btn-sm btn-go" target="_blank" rel="noopener">å‰å¾€é é¢</a>
                  <button class="btn btn-sm btn-cancel">å–æ¶ˆæ”¶è—</button>
                </div>
              </div>
              <div class="museum-comment-box">
                <label for="comment-${name.replace(
                  /\s+/g,
                  "-"
                )}" class="form-label visually-hidden">è©•è«–</label>
                <textarea class="form-control" id="comment-${name.replace(
                  /\s+/g,
                  "-"
                )}" rows="3" placeholder="å‚™å¿˜éŒ„..." data-name="${name}">${comment}</textarea>
              </div>
            `;
            favListElement.appendChild(li);
          });
        }
        if (favCountElement) {
          favCountElement.textContent = `æ”¶è— ${data.length}`;
        }
      }

      // å„²å­˜è©•è«–
      function saveComment(name, comment) {
        let data = getFavorites();
        const item = data.find((item) => item.name === name);
        if (item) {
          item.comment = comment;
          localStorage.setItem("favorites", JSON.stringify(data));
        }
      }

      // è™•ç†å–æ¶ˆæ”¶è—
      function handleCancelFavorite(name) {
        let data = getFavorites();
        data = data.filter((item) => item.name !== name);
        localStorage.setItem("favorites", JSON.stringify(data));
        renderFavs();
      }

      // è¼‰å…¥å´é‚Šé¸å–®åœ‹å®¶åˆ—è¡¨
      function loadCountries(region, menuId) {
        const countries = {
          "Western Europe": [
            { name_zh: "æ³•åœ‹", link: "France.html" },
            { name_zh: "è·è˜­", link: "Netherlands.html" },
            { name_zh: "è‹±åœ‹", link: "#" },
            { name_zh: "å¾·åœ‹", link: "#" },
            { name_zh: "æ¯”åˆ©æ™‚", link: "#" },
            { name_zh: "ç‘å£«", link: "#" },
          ],
          "Southern Europe": [
            { name_zh: "ç¾©å¤§åˆ©", link: "#" },
            { name_zh: "è¥¿ç­ç‰™", link: "#" },
            { name_zh: "å¸Œè‡˜", link: "#" },
          ],
          "Eastern Europe": [
            { name_zh: "æ·å…‹", link: "#" },
            { name_zh: "åŒˆç‰™åˆ©", link: "#" },
            { name_zh: "æ³¢è˜­", link: "#" },
          ],
          "Northern Europe": [
            { name_zh: "ç‘å…¸", link: "#" },
            { name_zh: "èŠ¬è˜­", link: "#" },
            { name_zh: "æŒªå¨", link: "#" },
          ],
        };
        const menu = document.getElementById(menuId);
        if (!menu) return;
        menu.innerHTML = "";
        (countries[region] || []).forEach((c) => {
          const li = document.createElement("li");
          li.innerHTML = `<a class="dropdown-item" href="${c.link}">${c.name_zh}</a>`;
          menu.appendChild(li);
        });
      }

      // é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œä¸»è¦é‚è¼¯
      document.addEventListener("DOMContentLoaded", () => {
        const loginBtn = document.getElementById("loginBtn");
        const userNameDisplay = document.querySelector(".user-card .card-text");
        const favListElement = document.getElementById("favList");

        // ç™»å…¥ç‹€æ…‹æª¢æŸ¥èˆ‡ UI æ›´æ–°
        let loggedIn = localStorage.getItem("loggedIn") === "true";
        if (!loggedIn) {
          loginBtn.href =
            "log.html?redirect=" + encodeURIComponent(window.location.pathname);
          userNameDisplay.textContent = "è«‹å…ˆç™»å…¥";
          if (favListElement) {
            favListElement.innerHTML = `<li class='list-group-item text-center'>å°šæœªç™»å…¥ï¼Œè«‹å…ˆç™»å…¥æŸ¥çœ‹æ”¶è—</li>`;
          }
        } else {
          loginBtn.textContent = "ç™»å‡º";
          loginBtn.href = "#";
          loginBtn.onclick = () => {
            localStorage.removeItem("loggedIn");
            localStorage.removeItem("username");
            alert("å·²ç™»å‡ºï¼");
            window.location.reload();
          };
          const username = localStorage.getItem("username") || "ç”¨æˆ¶";
          userNameDisplay.textContent = username;
          renderFavs();
        }

        // äº‹ä»¶ç›£è½å™¨ï¼šå–æ¶ˆæ”¶è—èˆ‡è©•è«–
        if (favListElement) {
          favListElement.addEventListener("click", (e) => {
            if (e.target.classList.contains("btn-cancel")) {
              const li = e.target.closest("li");
              const name = li?.dataset.name;
              if (name) {
                handleCancelFavorite(name);
              }
            }
          });

          favListElement.addEventListener("input", (e) => {
            if (e.target.tagName === "TEXTAREA") {
              const name = e.target.dataset.name;
              const comment = e.target.value;
              if (name) {
                saveComment(name, comment);
              }
            }
          });
        }

        // è¼‰å…¥å´é‚Šé¸å–®
        loadCountries("Western Europe", "WesternEuropeMenu");
        loadCountries("Southern Europe", "SouthernEuropeMenu");
        loadCountries("Eastern Europe", "EasternEuropeMenu");
        loadCountries("Northern Europe", "NorthernEuropeMenu");
      });
    </script>
  </body>
</html>
